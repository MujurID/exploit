# Open Redirect Vulnerability Lead to XSS Injection at Official Website PointBlank Zepetto Indonesia
### Author : Mikhro <br><a href="https://www.facebook.com/josh.s.mikhael" rel="nofollow"><img src="https://img.shields.io/badge/contact-facebook-blue.svg" alt="Twitter" data-canonical-src="https://img.shields.io/badge/facebook-josh.s.mikhael-blue.svg" style="max-width:100%;"></a>
> #Exploit #XSS #Injection #PointBlank_Zepetto #Bug #OpenRedirect



## Apa itu Open Redirect Vulnerability ??
Berdasarkan https://s0cket7.com/open-redirect-vulnerability/ dapat disimpulkan bahwa : <br>
**Open Redirect** atau **Pengalihan Terbuka** adalah jenis celah/bug yang memungkinkan seseorang untuk mengalihkan sebuah situs web (*web victim*)
menuju ke situs web apapun tanpa adanya ~~peringatan~~ akan meninggalkan situs tersebut.

## Apa itu XSS Injection ?? 
Dikutip dari https://id.m.wikipedia.org/wiki/XSS, <br>
**XSS** merupakan salah satu jenis serangan *injeksi code* (code injection attack). XSS dilakukan oleh penyerang dengan cara memasukkan kode HTML atau client script code lainnya ke suatu situs. Serangan ini akan seolah-olah datang dari situs tersebut. Akibat serangan ini antara lain penyerang dapat mem-bypass keamanan di sisi klien, mendapatkan informasi sensitif, atau menyimpan aplikasi berbahaya.

## Proof Of Concept
Pada hari Minggu, 07/04/2019 sekitar jam 16.00 saya sedang duduk santai di teras rumah utk menikmati sore hari sambil ngopi . Saat itu saya merasa sangat bosan sehingga akhirnya saya memutuskan mengambil hp Android kesayangan saya dan berencana bermain PUBG sebentar . Sebelum main saya menyempatkan untuk melihat-lihat beranda facebook. Ketika scroll beranda , saya melihat ada postingan dari Official Fanpage PointBlank Zepetto Indonesia tentang update patch serta new map & new mode . Berhubung saya juga sudah lama tidak memainkan game tersebut , saya pun tertarik untuk mencari tahu eventÂ² apa saja yg sedang berlangsung di game ini .<br> Sampe akhirnya saya mengunjungi fanpage dari game ini. Setelah membaca postingan fanpage saya beralih untuk membaca berita langsung dari website resmi nya . Saat itu entah kenapa terlintas di pikiran saya untuk iseng mencari bug dan melakukan penetration testing pada website tersebut.

![Screenshot_Websige_Pb_Zepetto](https://robotmikhro.github.io/img/Screenshot_2019-04-11-15-52-53-567_com.android.chrome.png)

Hal pertama yang akan saya lakukan adalah melakukan pengecekan pada halaman dashboard user/halaman info. Setelah itu saya cek satu-satu pertama pada bagian Submit Ticket lalu halaman Profil dan Notification . Namun saya tidak menemukan adanya celah dibagian tersebut. Berpikir sejenak , sambil menyeruput kopi , tiba-tiba perhatian saya tertuju bagian widget "PUSAT ISI ULANG" . 

![ss-pusat-isi-ulang](https://robotmikhro.github.io/img/IMG_20190411_161346.jpg)
Pikir saya mungkin saja pada bagian tersebut ada form yg vuln akan xss atau gk sqli :v . Dengan rasa penasaran , saya pun mengklik widget tersebut . Setelah mengklik saya langsung ter-redirect ke website https://topup.pointblank.id/Topup/Index . Terlintas dalam pikiran saya bahwa ketika saya ter-redirect tidak ada ~~notice~~ akan meninggalkan website https://wwww.pointblank.id/mypage/info melainkan langsung ter-redirect begitu saja . "Hmm .. " , guman saya. "Mungkinkah vuln akan open redirect ?",kata saya dalam hati. <br> Untuk menyelidiki hal tersebut, saya pun mencari tools untuk melakukan sniff pada website, berhubung saya hanya bermodalkan Smartphone Android , saya memakai [Net Capture](https://play.google.com/store/apps/details?id=com.minhui.networkcapture&hl=en_US&referrer=utm_source%3Dgoogle%26utm_medium%3Dorganic%26utm_term%3Dnet+capture&pcampaignid=APPU_1_eguvXOzMLcz5vAS6lYfwDw). Sebelum itu saya kembali ke halaman info lalu menyalakan Net Capture dan mengklik ulang widget "PUSAT ISI ULANG PB" . Dan ini hasilnya :
![ss-hasil-sniff](https://robotmikhro.github.io/img/IMG_20190411_164357.jpg)

â€¢Jika kita lihat pada bagian GET ada parameter :
> ?redirect_url=https://topup.pointblank.id

â€¢Lalu saya coba ganti url pada param tsb dengan https://www.google.com , sehingga menjadi seperti ini :
> https://www.pointblank.id/topup/auth?redirect_url=https://www.google.com


â€¢Hasilnya website ter-redirect dengan baik . Tanpa ada ~~notice~~ untuk meninggalkan website. 
![ss-sukses-redir-ke-google](https://robotmikhro.github.io/img/IMG_20190411_172620.jpg) <br><br>
â€¢Hasil sniff : <br>
![ss-hasil-sniff](https://robotmikhro.github.io/img/IMG_20190411_172804.jpg) <br><br>
"Yeah ! Vuln **Open Redirect** ! ðŸ˜ƒ... ", kata saya dengan perasaan senang ! <br>
![senang](https://media.giphy.com/media/yhRnl31SmMec/giphy.gif)

Walau saya sudah menemukan bug open redirect , rasanya saya belum puas. "Mungkin saja bug ini bisa menjadi bug XSS juga!Hmm... ",pikir saya.<br>
![hmm](https://media.giphy.com/media/3oFzm6E7ULKzGbLm80/giphy.gif) <br>

Maka dari itu saya kembali melakukan research . Krn saya sempet melihatÂ² di google dan hacker one, kebanyakan bug **Open Redirect** can Lead to **XSS Injection** . <br>
Sayapun mengecek kembali hasil sniff sebelumnya , dan apa yg saya temukan ? <br>
![ss_kodejs](https://robotmikhro.github.io/img/IMG_20190411_184642.jpg) <br><br>
â€¢Berikut kodenya :
```
<script type="text/javascript">
	$(window).on("load",
 function() {
	
			document.location='https://www.google.com?access_token=8yBkBhDOZOgz1cumNxfU5Ib8Py%2Be4xcn%2FS3buZRsjntsV4459wFto99j%2B83K1W67drk%2BaNP5IyyeaUS%2BZEVrKXdSbOfIbVpA3IZABGgJ7Zk%3D';
	
		
});
	</script>
```
Melihat kode diatas dapat saya simpulkan bahwa url *google.com* yang ada pada parameter "*?redirect_url=*" ter-refleksi ke dalam kode javascript ini sehingga proses redirect dapat berjalan dengan baik .<br>
Disini yang harus saya lakukan adalah melakukan bypass pada document.location . Saya berusaha memahami kode javascript ini dan mencari tahu bagaimana agar saya dapat membypass "*document.location*" dan memunculkan pop up **XSS** . <br> Dibantu oleh teman saya [@Nugra](https://github.com/anysz) akhirnya saya sukses melakukan bypass. Berikut langkah-langkahnya : <br><br>

### Langkah - Langkah Bypass *document.location* :
1. Jika kita lihat , melalui kode di atas inject point nya terletak di akhir url <br> ``` document.location='https://www.google.com' ``` (perhatikan yang saya beri tanda petik , disitulah inject pointnya). Disitulah kita akan mulai melakukan bypass. <br>
2. Lalu saya mencoba untuk memasukkan ``` .strpos(0,0); ``` , menjadi seperti ini ``` document.location='https://www.google.com'.strpos(0,0); ``` <br> Namun tidak terjadi apaÂ² & page tidak ter-redirect.<br>
3. Setelah melalui beberapa pertimbangan , jika kita perhatikan string ``` document.location ```itu sudah ada isinya yaitu "google.com" jadi untuk membersihkannya menurut saya lebih baik saya lebih baik menggunakan fungsi [substr()](https://www.malasngoding.com/manipulasi-string-pada-javascript/) ketimbang fungsi [strpos()](https://www.duniailkom.com/tutorial-php-cara-mencari-posisi-string-php-fungsi-strpos/) atau bisa dikatakan penggunaan substr itu buat ngambil slice dari string nya . Saya tambahkan 0,0 menjadi
.substr(0,0); , jika kita taro di parameter jadi seperti ini : <br> ``` document.location='https://www.google.com'.substr(0,0); ``` <br>
![this_ss_sniff](https://robotmikhro.github.io/img/IMG_20190411_211414.jpg) <br>
![this_ss_kodejs](https://robotmikhro.github.io/img/IMG_20190411_211441.jpg)











